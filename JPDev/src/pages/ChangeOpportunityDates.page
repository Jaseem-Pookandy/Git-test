<apex:page standardController="Opportunity" extensions="ChangeOpportunityDatesController" showHeader="true" tabStyle="Opportunity" action="{!PrepPage}">

    <apex:form id="changeDatesForm">
    
         <apex:actionstatus id="disableScreen">
            <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: rgba(0, 0, 0, 0.5); height:100%; width:100%; z-index: 9998; left: 0; top: 0; position: absolute;"> 
                    <div class="waitingHolder" style="top: 100px; width: 200px; height:80px; border-radius: 25px; border: 2px solid #000000; background-color:#FFFFFF; z-index:9999; text-align: center; padding: 5px;">
                        <br/>
                        <img class="waitingImage" src="/img/loading.gif" />
                        <br/><br/>
                        <span><strong>Processing...</strong></span>
                    </div>
                </div>
            </apex:facet>
            <apex:facet name="stop">
            </apex:facet>
        </apex:actionstatus>   

        <apex:sectionHeader title="{!header}" />

            <apex:pageblock id="pageBlock" mode="edit">

            <apex:outputPanel id="informativeMessages" style="width: 100%;">
                <!-- after review, this section is not needed, code will remain, but changing to rendered=false if they decide they want it -->
                <!-- apex:pageMessage severity="info" strength="2" title="" rendered="{!infos.size > 0}" escape="false"-->
                <apex:pageMessage severity="info" strength="2" title="" rendered="false" escape="false">
                    <apex:dataList value="{!infos}" var="specificInfo">
                        {!specificInfo}
                    </apex:dataList>
                </apex:pageMessage>
            </apex:outputPanel>

            <apex:outputPanel id="errorMessages" style="width: 100%;">
                <apex:pageMessage severity="warning" strength="2" title="Warning!" rendered="{!errors.size > 0}">
                    <apex:dataList value="{!errors}" var="specificError">
                        {!specificError}
                    </apex:dataList>
                </apex:pageMessage>
            </apex:outputPanel>

            <apex:pageBlockButtons >
                <apex:commandButton action="{!Save}" value="Save" />
                <apex:commandButton action="{!cancel}" value="Cancel" />
            </apex:pageBlockButtons>

            <apex:pageBlockSection id="dateDetails" title="Change Dates" collapsible="false" columns="2">

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Change to Specific Date:" for="specificDate" />
                    <apex:inputCheckbox value="{!specificDateMethod}" id="specificDate">
                        <apex:actionSupport event="onchange" action="{!specificDateChanged}" reRender="dateDetails, recordsToModify, informativeMessages, errorMessages" status="disableScreen"/>
                    </apex:inputCheckbox>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!specificDateMethod}">
                    <apex:outputLabel value="Specific Date:" for="specificDateValue" />

                    <apex:outputPanel >                     
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputField value="{!dummyOpp.Developer_VF_Date__c}" id="specificDateValue">
                                <apex:actionSupport event="onchange" action="{!specificDateChanged}" reRender="dateDetails, recordsToModify, informativeMessages, errorMessages" status="disableScreen"/>
                            </apex:inputField>
                        </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!specificDateMethod == false}" />

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Change to Variable Date:" for="variableDate" />
                    <apex:inputCheckbox value="{!variableDateMethod}" id="variableDate">
                        <apex:actionSupport event="onchange" action="{!variableDateChanged}" reRender="dateDetails, recordsToModify, informativeMessages, errorMessages" status="disableScreen"/>
                    </apex:inputCheckbox>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!variableDateMethod}">
                    <apex:outputLabel value="Variable Date Offset Change:" for="variableDateValue"/>
                    <apex:outputPanel >                     
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:selectList id="variableDateValue" value="{!variableValue}" size="1">
                                <apex:selectOptions value="{!VariableOptions}"/>
                                <apex:actionSupport event="onchange" action="{!variableDateChanged}" reRender="dateDetails, recordsToModify, informativeMessages, errorMessages" status="disableScreen"/>
                            </apex:selectList>
                        </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!variableDateMethod == false}" />

            </apex:pageBlockSection>

            <br/>

            <apex:pageBlockSection id="oppDetails" title="Affected Opportunities" collapsible="false" columns="2"/>


            <apex:PageBlockTable value="{!Opps}" var="opp" id="recordsToModify">
                <apex:column headerValue="Owned By">
                    <apex:outputLink value="/{!opp.opportunity.OwnerId}">{!opp.opportunity.Owner.Name}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Opportunity Name">
                    <apex:outputLink value="/{!opp.opportunity.Id}">{!opp.opportunity.Name}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Stage">
                    <apex:outputField value="{!opp.opportunity.StageName}" />
                </apex:column>
                <apex:column headerValue="Brand">
                    <apex:outputField value="{!opp.opportunity.Primary_Brand__c}" />
                </apex:column>
                <apex:column headerValue="Account">
                    <apex:outputLink value="/{!opp.opportunity.Account.Id}">{!opp.opportunity.Account.Name}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Contact">
                    <apex:outputLink value="/{!opp.opportunity.Contact__r.Id}">{!opp.opportunity.Contact__r.Name}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Sold By Partner">
                    <apex:outputLink value="/{!opp.opportunity.Sold_By_Partner__r.Id}">{!opp.opportunity.Sold_By_Partner__r.Name}</apex:outputLink>
                </apex:column>
                <apex:column headerValue="Original Close Date">
                    <apex:outputField value="{!opp.opportunity.Orig_CloseDate__c}" />
                </apex:column>
                <apex:column headerValue="(Current) Close Date">
                    <apex:outputField value="{!opp.opportunity.CloseDate}" />
                </apex:column>
                <apex:column headerValue="(New) Close Date">
                    <apex:outputText value="{!opp.PrettyNewCloseDate}" />
                </apex:column>              
            </apex:PageBlockTable>

            </apex:pageblock>
    </apex:form>
</apex:page>