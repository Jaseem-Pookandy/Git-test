<apex:page showHeader="true" title="One Post Order" standardController="One_Post_Order__c" extensions="OnePostPageController" tabStyle="One_Post_Order__c" >
  
    <style type="text/css">
        .bigOlBox { 
          width: 600px; 
        }

        .widePicklist { 
          width: 40% !important; 
        }

        .superWidePicklist { 
          width: 70% !important; 
        }        

    </style>

    <apex:form id="OnePostForm">

        <apex:actionstatus id="disableScreen">
            <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: rgba(0, 0, 0, 0.5); height:100%; width:100%; z-index: 9998; left: 0; top: 0; position: absolute;"> 
                    <div class="waitingHolder" style="top: 100px; width: 200px; height:80px; border-radius: 25px; border: 2px solid #000000; background-color:#FFFFFF; z-index:9999; text-align: center; padding: 5px;">
                        <br/>
                        <img class="waitingImage" src="/img/loading.gif" />
                        <br/><br/>
                        <span><strong>Processing...</strong></span>
                    </div>
                </div>
            </apex:facet>
            <apex:facet name="stop">
            </apex:facet>
        </apex:actionstatus>

      
      <apex:sectionHeader title="One Post Order"/>
      
      <apex:pageBlock id="OnePostPB" mode="edit" >

            <apex:outputPanel id="errorMessages" style="width: 100%;">
                <apex:pageMessage severity="error" strength="3" title="Unable to continue until the following errors are corrected:" rendered="{!validationErrors.size > 0}">
                        <apex:dataList value="{!validationErrors}" var="specificError">
                            {!specificError}
                        </apex:dataList>
                </apex:pageMessage>
            </apex:outputPanel>

           <apex:pageBlockButtons >
               <apex:commandButton action="{!SaveItAll}" value="Process" reRender="errorMessages" status="disableScreen" /> 
               <apex:commandButton action="{!Cancel}" value="Cancel" />
           </apex:pageBlockButtons>
           
           <apex:pageBlockSection title="Information" id="info" collapsible="true" rendered="false">
               <apex:inputField value="{!NewOrder.Status__c}"/>
           </apex:pageBlockSection>

           <apex:pageBlockSection title="Client Information" id="clientinfo" collapsible="true">
              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Account"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                    <apex:inputField value="{!NewOrder.Account__c}"/>
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem>
           </apex:pageBlockSection>
           
           <apex:pageBlockSection title="Order Information" id="orderinfo" collapsible="true">

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Opportunity Owner"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                    <apex:inputField value="{!NewOrder.Opportunity_Owner__c}" />
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem>
              
               <apex:inputField value="{!NewOrder.CurrencyISOCode}">
                   <apex:actionSupport event="onchange" action="{!RecalcData}" rerender="agreementinfo,productinfo,totalpriceinfo,errorMessages" status="disableScreen"/>
               </apex:inputField>

               <apex:inputField value="{!NewOrder.Purchase_Date__c}"/>
               <apex:inputField value="{!NewOrder.IO_Number__c}"/>

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Payment Term"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                      <apex:inputField value="{!NewOrder.PaymentTerm__c}"/>
                    </div>
                  </apex:outputPanel>               
              </apex:pageBlockSectionItem>

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Country"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                    <apex:inputField value="{!NewOrder.Country__c}"/>
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem>

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Payment Method"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                      <apex:inputField value="{!NewOrder.PaymentMethod__c}"/>
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem> 

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Quantity"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                     <apex:inputField value="{!NewOrder.Quantity__c}">
                         <apex:actionSupport event="onchange" action="{!RecalcData}" rerender="agreementinfo,productinfo,totalpriceinfo,errorMessages" status="disableScreen"/>
                     </apex:inputField>     
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem>      
               
           </apex:pageBlockSection>
           
            <apex:pageBlockSection title="Product Selection" id="productSelectionPBS" collapsible="false" columns="1">

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="BrandTag"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                    <apex:inputField value="{!NewOrder.BrandTag__c}" styleClass="widePicklist">
                      <apex:actionSupport event="onchange" action="{!RecalcData}" rerender="agreementinfo,productinfo,totalpriceinfo,errorMessages, productSelectionPBS" status="disableScreen">
                        <apex:param assignTo="{!fromBrandTag}" value="{true}" name="fromBrandTag" />
                      </apex:actionSupport>
                    </apex:inputField>
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem>

              <!-- //Because --None-- doesn't count only render if the size is greater than 1. -->
              <apex:pageBlockSectionItem rendered="{!availableProducts.size > 1}" >
                <apex:outputLabel value="Product Rate Plan"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                    <apex:selectList id="product_ddl" value="{!selectedRatePlanId}" size="1" styleClass="widePicklist" >
                      <apex:selectOptions value="{!availableProducts}" />
                        <apex:actionSupport event="onchange" reRender="agreementinfo, totalpriceinfo" action="{!RecalcData}" status="disableScreen"/> 
                      </apex:selectList>
                    </div>
                  </apex:outputPanel>               
                </apex:pageBlockSectionItem>                  

              <apex:pageBlockSectionItem rendered="{!availableProducts.size <= 1 && NewOrder.BrandTag__c != null}" >
                <apex:outputLabel value="Product Rate Plan"/>
                <apex:outputText value="Unable to find available Product Rate Plans that match the provided data.  Please confirm your data and then if necessary, alert your System Administrator. "/>
              </apex:pageBlockSectionItem>

           </apex:pageBlockSection>
           
           <apex:pageBlockSection title="Sold By Partner Information" id="partnerinfo" collapsible="true">

              <apex:pageBlockSectionItem >
                <apex:outputLabel value="Contact"/>
                <apex:outputPanel >                     
                  <div class="requiredInput">
                    <div class="requiredBlock"></div>
                    <apex:inputField value="{!NewOrder.Contact__c}">
                      <apex:actionSupport event="onchange" action="{!RecalcData}" rerender="agreementinfo,totalpriceinfo,errorMessages" status="disableScreen"/>
                    </apex:inputField>         
                  </div>
                </apex:outputPanel>                 
              </apex:pageBlockSectionItem>
                
           </apex:pageBlockSection>

           <apex:pageBlockSection title="Notes" id="notesinfo" collapsible="true">
               <apex:inputField value="{!NewOrder.Notes__c}" styleClass="bigOlBox" />
           </apex:pageBlockSection>
                   
           <apex:pageBlockSection title="Order Review" id="agreementinfo" rendered="true" columns="1" >

                  <apex:pageBlockTable value="{!products}" title="Products and Discounts" id="productinfo" var="p" style="width:100%;" align="center" rendered="{!products.size!=0}">         
                        <apex:variable var="rowNump" value="{!0}"  />   
                        
                        <apex:column headerValue="#" style="width:20px; text-align:center;" headerClass="centertext">
                            <apex:outputText value="{0,number, ###}" style="text-align:center;">   
                                <apex:param value="{!rowNump}" />   
                            </apex:outputText>
                        </apex:column> 
                        <apex:column >
                            <apex:facet name="header">Product Rate Plan Name</apex:facet>
                            <apex:outputField value="{!p.Name}" />
                        </apex:column>         
                        <apex:column >
                            <apex:facet name="header">BrandTag</apex:facet>
                            <apex:outputField value="{!p.BrandTag__c}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Effective Start</apex:facet>
                            <apex:outputField value="{!p.zqu__EffectiveStartDate__c}" />
                        </apex:column>                                                    
                        <apex:column >
                            <apex:facet name="header">Effective End</apex:facet>
                            <apex:outputField value="{!p.zqu__EffectiveEndDate__c}" />
                            <apex:variable var="rowNump" value="{!rowNump+1}"/>
                        </apex:column>     
                    </apex:pageBlockTable>     
                    
<!--                   <apex:pageBlockTable value="{!charges}" title="Product and Discount Charges" id="chargeinfo" var="c" style="width:100%;" align="center" rendered="{!charges.size!=0}">         
                        <apex:variable var="rowNumc" value="{!0}"  />   
                        
                        <apex:column headerValue="#" style="width:20px; text-align:center;" headerClass="centertext">
                            <apex:outputText value="{0,number, ###}" style="text-align:center;">   
                                <apex:param value="{!rowNumc}" />   
                            </apex:outputText>
                        </apex:column> 
                        <apex:column >
                            <apex:facet name="header">Charge Name</apex:facet>
                            <apex:outputField value="{!c.Name}" />
                        </apex:column>         
                        <apex:column >
                            <apex:facet name="header">Description</apex:facet>
                            <apex:outputField value="{!c.zqu__Description__c}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Model</apex:facet>
                            <apex:outputField value="{!c.zqu__Model__c}" />
                        </apex:column>                                                    
                        <apex:column >
                            <apex:facet name="header">Charge Type</apex:facet>
                            <apex:outputField value="{!c.zqu__Type__c}" />
                            <apex:variable var="rowNumc" value="{!rowNumc+1}"/>
                        </apex:column>     
                    </apex:pageBlockTable>   -->
                                     
                  <apex:pageBlockTable value="{!agreements}" title="Active Agency Agreements" var="t" style="width:100%;" align="center" rendered="{!agreements.size!=0}">         
                        <apex:variable var="rowNuma" value="{!0}"  />   
                        
                        <apex:column headerValue="#" style="width:20px; text-align:center;" headerClass="centertext">
                            <apex:outputText value="{0,number, ###}" style="text-align:center;">   
                                <apex:param value="{!rowNuma}" />   
                            </apex:outputText>
                        </apex:column> 
                        <apex:column >
                            <apex:facet name="header">Sold By Partner Name</apex:facet>
                            <apex:outputField value="{!t.Account__c}" />
                        </apex:column>         
                        <apex:column >
                            <apex:facet name="header">Agreement Name</apex:facet>
                            <apex:outputField value="{!t.Name}" />
                        </apex:column>
                        <apex:column >
                            <apex:facet name="header">Brand</apex:facet>
                            <apex:outputField value="{!t.Brand_Name__c}" />
                        </apex:column>                                                    
                        <apex:column >
                            <apex:facet name="header">Status</apex:facet>
                            <apex:outputField value="{!t.Status__c}" />
                        </apex:column>     
                        <apex:column >
                            <apex:facet name="header">Country</apex:facet>
                            <apex:outputField value="{!t.Country__c}" />
                        </apex:column>                             
                        <apex:column >
                            <apex:facet name="header">Start Date</apex:facet>
                            <apex:outputField value="{!t.Start_Date__c}" />
                        </apex:column>  
                        <apex:column >
                            <apex:facet name="header">End Date</apex:facet>
                            <apex:outputField value="{!t.End_Date__c}" />
                        </apex:column> 
                        <apex:column >
                            <apex:facet name="header">Discount Percent</apex:facet>
                            <apex:outputField value="{!t.Discount_Percent__c}" />
                            <apex:variable var="rowNuma" value="{!rowNuma+1}"/>
                        </apex:column>
                                        
                    </apex:pageBlockTable> 

                 
           </apex:pageBlockSection>

           <apex:pageBlockSection title="Order Totals" id="totalpriceinfo" collapsible="true" rendered="true" columns="1" >

                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="List Price" />
                            <apex:outputText value="{!totalList}" /> 
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Discount Amount (Percent)" />
                            <apex:outputText value="{!totalDiscountAmt}  ({!theDiscount}%)" /> 
                        </apex:pageBlockSectionItem>                        
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Net Price" />
                            <apex:outputText value="{!totalNet}" /> 
                        </apex:pageBlockSectionItem>
                    
              </apex:pageBlockSection>     
           
      </apex:pageBlock>
  </apex:form>
</apex:page>